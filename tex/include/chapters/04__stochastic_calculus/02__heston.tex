\section{Heston model}

\begin{tcolorbox}[width=\linewidth, sharp corners=all, colback=white!95!black]
    Let's consider the Heston model. Tell me about its dynamics, pricing properties, simulation schemes, calibration.

\end{tcolorbox}

Heston model introduced in \cite{heston1993closed} is a stochastic volatility model that assumes the instantaneous variance dynamics follows a CIR (or square-root) process. It has dynamics:
\begin{equation*}
    \left\{
    \begin{aligned}
        dS_t &= \mu S_t \, dt + \sqrt{V_t}S_t \, dW_t \\
        dV_t &= \kappa (\theta - V_t) \, dt + \sigma \sqrt{V_t} \, dB_t,
    \end{aligned}
    \right.
\end{equation*}

with the two Brownians having correlation $\rho$: $\langle dW, dB \rangle_t = \rho dt.$ In the variance process, parameters are the long term variance level $\theta$, the mean-reversion speed $\kappa$  and the vol-of-vol $\sigma$. The set of parameter is $\Theta = \{\mu, \kappa, \theta, \sigma\}$.

Stochastic volatility has been introduced to allow calibration to the smiled and skewed shapes empirically when looking at quoted implied volatilities across different strikes on the market. Although for very short maturities with exploding wings stochastic volatility models may underestimate the options prices (hence the introduction of jumps with Bates model), they remain a very interesting and relevant class of models.

\subsubsection*{Thorough mathematical analysis}

\paragraph*{Existence of a solution}
non lipschitz coeffs, still there exists a unique solution
vol vol of vol corr assumed... 
feller condition

The Heston model belongs to the larger family of \textit{affine models}: the joint process $(\log S, V)$ has an explicit characteristic function that allows for fast and accurate pricing and hedging using Fourier inversion techniques. In  particular Heston model is an affine Markovian model; the popular Stein-Stein model belongs to this class as well, while the Bergomi and Hull-White models are non-affine Markovian models. 




\paragraph{Characteristic function} The Fourier-Laplace transform for the joint process $(\log S, V)$ is:
\begin{equation}\label{eqn:charac_func}
    \mathbb{E}\left[e^{u \log S_T} \mid \mathcal{F}_t\right] = \exp \{ u \log S_t + \phi (T-t) + \psi (T-t)V_t \},
\end{equation}
where $\phi, \psi$ are the solutions of Riccati equations -- this allows for tractability and fast calibration of the model\footnote{The log-price satisfies \ref{eqn:charac_func}, however there exists similar equations for other quantities of interest, for instance spot variance and integrated spot variance.}.

\begin{proof}
    Let's start by finding the \underline{pricing partial differential equation} associated with the model. Feynman-Kac links SDEs to PDEs: for a call price,
    \[
        \dfrac{\partial C}{\partial t} + \mathcal{A}C - rC = 0,
    \]
    with $\mathcal{A}$ the infinitesimal operator of the diffusion,
    \[\mathcal{A} = rS \dfrac{\partial}{\partial S} + \kappa(\theta - V) \dfrac{\partial}{\partial V} + \rho \sigma S V \dfrac{\partial^2}{\partial S \partial V} + \dfrac1{2} V S^2 \dfrac{\partial^2}{\partial S^2} + \dfrac1{2} \sigma^2 V \dfrac{\partial^2}{\partial V^2}.\]


    with $r = \mu - \frac1{2}\sigma^2$ for switching from the statistical measure to the risk-neutral measure. A financial construction, applying It\^o to an hedged portfolio leads to the same PDE.


    Then we make an \underline{\textit{ansatz}} for the solution: we assume it looks like \[C(S_t, V_t, t, T) = S_t P_1 - K e^{-r(T-t)} P_2\footnote{This is not a surprise when we know Black-Scholes formula for vanillas. Financial practitioners can read these quantities as in-the-money probabilities: $P_1 = \mathbb{Q}^S(S_T > K), P_2 = \mathbb{Q}(S_T > K)$, with the probability measures under different numeraires.}.\]
    To simplify this, we transform the first argument to the log-moneyness $x=\log(F / K)$, $F$ the $T-$forward price of the stock seen from $t$, and the time to maturity $\tau = T-t$. The ansatz becomes $C(x,y,\tau) = K\left[e^x P_1(x,y,\tau) - P_2(x,y,\tau)\right]$.

    Plugging this ansatz into the pricing PDE,

    
\end{proof}

\paragraph{FFT expression:} then we can derive a model-free formula for vanilla option prices.

Under a risk-neutral measure $\mathbb{Q}$, the price of a the European call option with maturity $T$ and strike $K$ is:
\begin{align*}
    C_t = e^{-r(T-t)} \mathbb{E}^{\mathbb{Q}}\left[(S_T - K)^{+}\right]
    &= e^{-r(T-t)} (\mathbb{E}^{\mathbb{Q}}\left[K \mathbbm{1}_{S_T > K}\right] - \mathbb{E}^{\mathbb{Q}}\left[S_T \mathbbm{1}_{S_T > K}\right]).
\end{align*}

The second expectation can be computed as $\mathbb{E}^{\mathbb{Q}}\left[S_T \mathbbm{1}_{S_T > K}\right] = K\mathbb{Q}(S_T>K)$ while for the first one we can introduce a change of num\'eraire \cite{el1995changes}. Introducing the change of measure $\dfrac{d\mathbb{Q}_S}{d\mathbb{Q}} \Big|_{\mathcal{F}_t}$, setting the underlying price as num\'eraire, \[\mathbb{E}^{\mathbb{Q}}\left[S_T \mathbbm{1}_{S_T > K}\right] = \mathbb{E}^{\mathbb{Q}}[S_T] \mathbb{E}^{\mathbb{Q}}\left[\dfrac{S_T}{\mathbb{E}^{\mathbb{Q}}[S_T]} \mathbbm{1}_{S_T > K}\right] = e^{r(T-t)}S_t \mathbb{Q}_S(S_T>K)\].

Eventually the option price at time $t$ is \[C_t = S_t \mathbb{Q}_S(S_T>K) - e^{-r(T-t)}K\mathbb{Q}(S_T>K).\]

Then, for a random variable, the Gil-Pelaez inversion theorem \cite{gil1951note} relates the cumulative distribution function $F$ and its characteristic function $\phi$: \[F(x) = \frac1{2} + \frac1{2\pi} \int_0^\infty \dfrac{e^{itx}\phi(-t) - e^{-itx}\phi(t)}{it} dt.\]
Further computations using real and imaginary parts of an complex quantity $z$ (recall $\mathfrak{Re}(z) = \frac{z + z^{*}}{2}$ and $\mathfrak{Im}(z) = \frac{z - z^{*}}{2}$):
\[\mathbb{P}(X > x) = \frac1{2} + \frac1{\pi} \int_0^\infty \mathfrak{Re}\left[ \dfrac{e^{-itx}\phi(t)}{it} \right] dt.\]

\subsubsection*{Simulating}

\paragraph{Euler scheme}
For simulating such a process, we have to be careful about the values of the instantaneous variance. Indeed, nothing assures the positivity of the variance, but we have to take its square-root in the log price dynamics. Hence a naive Euler scheme is not feasible.

\paragraph{Exact $\chi^2$ sampling}

\paragraph{Calibration} Estimating the parameters

\subsubsection*{Other quantities of interest}

\paragraph{Forward variance}

The forward variance at time $t$ for maturity $T$ is defined as:
\[ \xi_t^T = \mathbb{E}\left[V_T \mid \mathcal{F}_t \right]. \]
Taking the expectation in the Heston dynamics yields $d \xi_t^T = \kappa (\theta - \xi_t^T) dT$, satisfied by $\xi_t^T = \theta + e^{-\kappa (T-t)} (\theta - V_t)$.
\newline Differentiating, we get \[d \xi_t^T = e^{-\kappa (T-t)} \sigma \sqrt{V_t} dB_t.\] In particular this allows to write Heston under an affine forward variance form.

Such a quantity can be used when computing VIX-related metrics, like pricing VIX vanilla options.

\paragraph{ATMF skew}

a v cool object haha

\paragraph{Link between volatility and vol-of-vol}

Let's consider the log-volatility process $\ln(\sigma_t)$, $\sigma_t = \sqrt{V_t}$, not to be confused with the vol-of-vol parameter $\sigma$.

let's consider the log-volatility dynamics as a transformation of the process $V$: $\ln(\sigma_t) = f(V_t, t)$ with $f \colon (x,t) \mapsto \ln(\sqrt{x})$.

Applying It\^o, we get :
\begin{align*}
    d\ln(\sigma_t) &= \dfrac{\partial f}{\partial x} dV_t + \frac1{2}\dfrac{\partial^2 f}{\partial x^2} d\langle V \rangle_t\\
    &= \frac1{2V_t} dV_t + \frac1{2}\left(\frac1{-V_t^2}\right)\sigma^2 V_t dt\\
    &= \frac1{\sigma_t^2} \left(\kappa(\theta - \sigma_t^2) - \dfrac{\sigma^2}{2}\right) dt + \dfrac{\sigma}{2\sigma_t}dW_t.
\end{align*}

We get a vol-of-vol of $\frac{\sigma}{2\sigma_t}$ in the Heston model, which implies that the volatility and the volatility of volatility will move in opposite directions. This is unconsistent with the empirical market observations. 

